{"version":3,"sources":["../src/client.js"],"names":["g","require","HttpClient","assert","xmlBuilder","XMLHandler","NamespaceContext","Operation","SOAPElement","Base","util","_","debug","debugDetail","debugSensitive","utils","Client","constructor","wsdl","endpoint","options","xmlHandler","definitions","schemas","_initializeServices","httpClient","setEndpoint","describe","describeServices","setSecurity","security","setSOAPAction","soapAction","SOAPAction","services","name","_defineService","service","ports","def","_definePort","location","port","binding","operations","_defineOperation","operation","self","temp","args","callback","extraHeaders","undefined","createPromiseCallback","_invoke","promise","$name","input","output","style","defs","ns","$targetNamespace","encoding","message","xml","req","headers","dynamicSoapHeaderProperty","dynamicSoapHeaders","soapNsURI","soapNsPrefix","envelopeKey","soapVersion","forceSoapVersion","lastIndexOf","length","soapActionRequired","merge","pick","omit","header","httpHeaders","attr","isEmpty","clearSoapHeaders","addSoapHeader","NTLMSecurity","addHttpHeaders","addOptions","nsContext","createNamespaceContext","envelope","createSOAPEnvelope","soapHeaderElement","soapBodyElement","body","addSoapHeadersToEnvelope","addSoapHeaders","uri","complexTypes","type","describeChildren","operationDescriptor","inputBodyDescriptor","inputHeadersDescriptor","jsonToXml","postProcess","prettyPrint","toString","pretty","doc","end","lastMessage","lastRequest","lastEndpoint","emit","tryJSONparse","JSON","parse","err","request","response","result","obj","lastResponse","lastResponseHeaders","lastElapsedTime","elapsedTime","indexOf","outputEnvDescriptor","faultEnvelope","outputEnvelope","xmlToJson","error","json","isObject","Header","Body","Error","f","outputBodyDescriptor","outputHeadersDescriptor","elements","qname","outputName","replace","forEach","term","hasOwnProperty","lastRequestHeaders","module","exports"],"mappings":"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","sourcesContent":["// Copyright IBM Corp. 2016,2019. All Rights Reserved.\n// Node module: strong-soap\n// This file is licensed under the MIT License.\n// License text available at https://opensource.org/licenses/MIT\n\n'use strict';\n\nvar g = require('./globalize');\nvar HttpClient = require('./http'),\n  assert = require('assert'),\n  xmlBuilder = require('xmlbuilder'),\n  XMLHandler = require('./parser/xmlHandler'),\n  NamespaceContext = require('./parser/nscontext'),\n  Operation = require('./parser/wsdl/operation'),\n  SOAPElement = require('./soapModel').SOAPElement,\n  Base = require('./base'),\n  util = require('util'),\n  _ = require('lodash'),\n  debug = require('debug')('strong-soap:client'),\n  debugDetail = require('debug')('strong-soap:client:detail'),\n  debugSensitive = require('debug')('strong-soap:client:sensitive'),\n  utils = require('./utils');\n\nclass Client extends Base {\n  constructor(wsdl, endpoint, options) {\n    super(wsdl, options);\n    options = options || {};\n    this.xmlHandler = new XMLHandler(wsdl.definitions.schemas, options);\n    this._initializeServices(endpoint);\n    this.httpClient = options.httpClient || new HttpClient(options);\n  }\n\n  setEndpoint(endpoint) {\n    this.endpoint = endpoint;\n    this._initializeServices(endpoint);\n  }\n\n  describe() {\n    return this.wsdl.describeServices();\n  }\n\n  setSecurity(security) {\n    this.security = security;\n  }\n\n  setSOAPAction(soapAction) {\n    this.SOAPAction = soapAction;\n  }\n\n  _initializeServices(endpoint) {\n    var definitions = this.wsdl.definitions;\n    var services = definitions.services;\n    for (var name in services) {\n      this[name] = this._defineService(services[name], endpoint);\n    }\n  }\n\n  _defineService(service, endpoint) {\n    var ports = service.ports;\n    var def = {};\n    for (var name in ports) {\n      def[name] = this._definePort(ports[name],\n        endpoint ? endpoint : ports[name].location);\n    }\n    return def;\n  }\n\n  _definePort(port, endpoint) {\n    var location = endpoint;\n    var binding = port.binding;\n    var operations = binding.operations;\n    var def = {};\n    for (var name in operations) {\n      def[name] = this._defineOperation(operations[name], location);\n      this[name] = def[name];\n    }\n    return def;\n  }\n\n  _defineOperation(operation, location) {\n    var self = this;\n    var temp;\n    return function(args, callback, options, extraHeaders) {\n      if (!args) args = {};\n      if (typeof args === 'function') {\n        callback = args;\n        args = {};\n      } else if (typeof options === 'function') {\n        temp = callback;\n        callback = options;\n        options = temp;\n      } else if (typeof extraHeaders === 'function') {\n        temp = callback;\n        callback = extraHeaders;\n        extraHeaders = options;\n        options = temp;\n      } else if (typeof callback === 'object') {\n        extraHeaders = options;\n        options = callback;\n        callback = undefined;\n      }\n      callback = callback || utils.createPromiseCallback();\n      self._invoke(operation, args, location, callback, options, extraHeaders);\n      return callback.promise;\n    };\n  }\n\n\n\n  _invoke(operation, args, location, callback, options, extraHeaders) {\n    var self = this,\n      name = operation.$name,\n      input = operation.input,\n      output = operation.output,\n      style = operation.style,\n      defs = this.wsdl.definitions,\n      ns = defs.$targetNamespace,\n      encoding = '',\n      message = '',\n      xml = null,\n      req = null,\n      soapAction,\n      headers = {\n        'Content-Type': 'text/xml; charset=utf-8'\n      },\n      dynamicSoapHeaderProperty = ['soapHeaders'],\n      dynamicSoapHeaders = {};\n\n    debug('client request. operation: %s args: %j options: %j extraHeaders: %j', operation.name, args, options, extraHeaders);\n\n    var soapNsURI = 'http://schemas.xmlsoap.org/soap/envelope/';\n    var soapNsPrefix = this.wsdl.options.envelopeKey || 'soap';\n\n    var soapVersion = this.wsdl.options.forceSoapVersion || operation.soapVersion;\n\n    if (soapVersion === '1.2') {\n      headers['Content-Type'] = 'application/soap+xml; charset=utf-8';\n      soapNsURI = 'http://www.w3.org/2003/05/soap-envelope';\n    }\n\n    debug('client request. soapNsURI: %s soapNsPrefix: %s ', soapNsURI, soapNsPrefix);\n\n    if (this.SOAPAction) {\n      soapAction = this.SOAPAction;\n    } else if (operation.soapAction != null) {\n      soapAction = operation.soapAction;\n    } else {\n      soapAction = ((ns.lastIndexOf(\"/\") !== ns.length - 1) ? ns + \"/\" : ns) + name;\n    }\n\n    if (soapVersion !== '1.2' || operation.soapActionRequired) {\n      headers.SOAPAction = '\"' + soapAction + '\"';\n    }\n\n    debug('client request. soapAction: %s', soapAction);\n\n    options = options || {};\n    debugSensitive('client request. options: %j', options);\n\n    dynamicSoapHeaders = _.merge(_.pick(extraHeaders, dynamicSoapHeaderProperty),\n\t                       _.pick(options, dynamicSoapHeaderProperty));\n\n    debug('Soap xml payload extra headers: %j', dynamicSoapHeaders);\n\n    extraHeaders = _.omit(extraHeaders, dynamicSoapHeaderProperty);\n    options = _.omit(options, dynamicSoapHeaderProperty);\n\n    //Add extra headers to http request\n    for (var header in this.httpHeaders) {\n      headers[header] = this.httpHeaders[header];\n    }\n    for (var attr in extraHeaders) {\n      headers[attr] = extraHeaders[attr];\n    }\n\n    // Clear and Add new SOAP Headers\n     if (!_.isEmpty(dynamicSoapHeaders)) {             \n        this.clearSoapHeaders();\n        for (var attr in dynamicSoapHeaders) {\n           this.addSoapHeader(dynamicSoapHeaders[attr]);\n        }\n    }\n    \n    debug('client request. headers: %j', headers);\n\n    //Unlike other security objects, NTLMSecurity is passed in through client options rather than client.setSecurity(ntlmSecurity) as some\n    //remote wsdl retrieval needs NTLM authentication before client object gets created. Hence, set NTLMSecurity instance to the client object\n    //so that it will be similar to other security objects from this point onwards.\n    if (self.httpClient.options && self.httpClient.options.NTLMSecurity) {\n      self.security = self.httpClient.options.NTLMSecurity;\n    }\n\n    // Allow the security object to add headers\n    if (self.security && self.security.addHttpHeaders) {\n      self.security.addHttpHeaders(headers);\n      debugSensitive('client request. options: %j', options);\n    }\n    if (self.security && self.security.addOptions) {\n      self.security.addOptions(options);\n      debugSensitive('client request. options: %j', options);\n    }\n\n\n\n    var nsContext = this.createNamespaceContext(soapNsPrefix, soapNsURI);\n    var xmlHandler = this.xmlHandler || new XMLHandler(this.wsdl.schemas, options);\n    var envelope = Client.createSOAPEnvelope(soapNsPrefix, soapNsURI);\n\n    var soapHeaderElement = envelope.header;\n    var soapBodyElement = envelope.body;\n    //add soapHeaders to envelope. Header can be xml, or JSON object which may or may not be described in WSDL/XSD.\n    this.addSoapHeadersToEnvelope(soapHeaderElement, this.xmlHandler);\n\n    if (self.security && self.security.addSoapHeaders) {\n      xml = self.security.addSoapHeaders(envelope.header);\n    }\n\n    let schemas = defs.schemas;\n\n\n    for(let uri in schemas) {\n      let complexTypes = schemas[uri].complexTypes;\n      if(complexTypes) {\n        for (let type in complexTypes) {\n            complexTypes[type].describe(this.wsdl.definitions);\n        }\n      }\n    }\n\n    for(let uri in schemas) {\n      let complexTypes = schemas[uri].complexTypes;\n      if(complexTypes) {\n        for (let type in complexTypes) {\n          complexTypes[type].describeChildren(this.wsdl.definitions);\n        }\n      }\n    }\n\n    var operationDescriptor = operation.describe(this.wsdl.definitions);\n    debugDetail('client request. operationDescriptor: %j', operationDescriptor);\n\n    var inputBodyDescriptor = operationDescriptor.input.body;\n    debug('client request. inputBodyDescriptor: %j', inputBodyDescriptor);\n\n    var inputHeadersDescriptor = operationDescriptor.input.headers;\n\n\n    debug('client request, calling jsonToXml. args: %j', args);\n    xmlHandler.jsonToXml(soapBodyElement, nsContext, inputBodyDescriptor, args);\n\n    if (self.security && self.security.postProcess) {\n      self.security.postProcess(envelope.header, envelope.body);\n    }\n\n    //Bydefault pretty print is true and request envelope is created with newlines and indentations\n    var prettyPrint = true;\n    //some web services don't accept request envelope with newlines and indentations in which case user has to set {prettyPrint: false} as client option\n    if (self.httpClient.options && self.httpClient.options.prettyPrint !== undefined) {\n      prettyPrint = self.httpClient.options.prettyPrint;\n    }\n\n    message = envelope.body.toString({pretty: prettyPrint});\n    xml = envelope.doc.end({pretty: prettyPrint});\n\n    debug('Request envelope: %s', xml);\n\n    self.lastMessage = message;\n    self.lastRequest = xml;\n    self.lastEndpoint = location;\n\n    self.emit('message', message);\n    self.emit('request', xml);\n\n    var tryJSONparse = function(body) {\n      try {\n        return JSON.parse(body);\n      }\n      catch (err) {\n        return undefined;\n      }\n    };\n\n    req = self.httpClient.request(location, xml, function(err, response, body) {\n      var result;\n      var obj;\n      self.lastResponse = body;\n      self.lastResponseHeaders = response && response.headers;\n      self.lastElapsedTime = response && response.elapsedTime;\n      self.emit('response', body, response);\n\n      debug('client response. response: %j body: %j', response, body);\n\n      if (err) {\n        callback(err);\n      } else {\n\n        //figure out if this is a Fault response or normal output from the server.\n        //There seem to be no good way to figure this out other than\n        //checking for <Fault> element in server response.\n        if (body.indexOf('<soap:Fault>') > -1  || body.indexOf('<Fault>') > -1) {\n          var outputEnvDescriptor = operationDescriptor.faultEnvelope;\n        } else  {\n          var outputEnvDescriptor = operationDescriptor.outputEnvelope;\n        }\n        try {\n          debugDetail('client response. outputEnvDescriptor: %j', outputEnvDescriptor);\n          obj = xmlHandler.xmlToJson(nsContext, body, outputEnvDescriptor);\n        } catch (error) {\n          //  When the output element cannot be looked up in the wsdl and the body is JSON\n          //  instead of sending the error, we pass the body in the response.\n          debug('client response. error message: %s', error.message);\n\n          if (!output) {\n            debug('client response. output not present');\n            //  If the response is JSON then return it as-is.\n            var json = _.isObject(body) ? body : tryJSONparse(body);\n            if (json) {\n              return callback(null, response, json);\n            }\n          }\n          //Reaches here for Fault processing as well since Fault is thrown as an error in xmlHandler.xmlToJson(..) function.\n          error.response = response;\n          error.body = body;\n          self.emit('soapError', error);\n          return callback(error, response, body);\n        }\n\n        if (!output) {\n          // one-way, no output expected\n          return callback(null, null, body, obj.Header);\n        }\n        if (typeof obj.Body !== 'object') {\n          var error = new Error(g.f('Cannot parse response'));\n          error.response = response;\n          error.body = body;\n          return callback(error, obj, body);\n        }\n\n        var outputBodyDescriptor = operationDescriptor.output.body;\n        var outputHeadersDescriptor = operationDescriptor.output.headers;\n\n        if (outputBodyDescriptor.elements.length) {\n          result = obj.Body[outputBodyDescriptor.elements[0].qname.name];\n        }\n        // RPC/literal response body may contain elements with added suffixes I.E.\n        // 'Response', or 'Output', or 'Out'\n        // This doesn't necessarily equal the ouput message name. See WSDL 1.1 Section 2.4.5\n        if (!result) {\n          var outputName = output.$name &&\n            output.$name.replace(/(?:Out(?:put)?|Response)$/, '');\n          result = obj.Body[outputName];\n        }\n        if (!result) {\n          ['Response', 'Out', 'Output', '.Response', '.Out', '.Output'].forEach(function(term) {\n            if (obj.Body.hasOwnProperty(name + term)) {\n              return result = obj.Body[name + term];\n            }\n          });\n        }\n        debug('client response. result: %j body: %j obj.Header: %j', result, body, obj.Header);\n\n        callback(null, result, body, obj.Header);\n      }\n    }, headers, options, self);\n\n    // Added mostly for testability, but possibly useful for debugging\n    if (req != null) {\n      self.lastRequestHeaders = req.headers;\n    }\n    debug('client response. lastRequestHeaders: %j', self.lastRequestHeaders);\n  }\n}\n\nmodule.exports = Client;\n"],"file":"client.js"}