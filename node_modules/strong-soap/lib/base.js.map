{"version":3,"sources":["../src/base.js"],"names":["EventEmitter","require","NamespaceContext","SOAPElement","xmlBuilder","XMLHandler","Base","constructor","wsdl","options","_initializeOptions","soapHeaders","httpHeaders","bodyAttributes","addSoapHeader","value","qname","header","push","changeSoapHeader","index","getSoapHeaders","clearSoapHeaders","setHttpHeader","name","String","addHttpHeader","val","getHttpHeaders","clearHttpHeaders","attributesKey","envelopeKey","forceSoapVersion","createSOAPEnvelope","prefix","nsURI","doc","create","version","encoding","standalone","attribute","element","body","findElement","schemas","definitions","schema","elements","createNamespaceContext","soapNsPrefix","soapNsURI","nsContext","declareNamespace","namespaces","xmlns","indexOf","addNamespace","addSoapHeadersToEnvelope","soapHeaderElement","xmlHandler","i","n","length","soapHeader","elementDescriptor","describe","jsonToXml","parseXml","xml","module","exports"],"mappings":"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","sourcesContent":["// Copyright IBM Corp. 2016,2017. All Rights Reserved.\n// Node module: strong-soap\n// This file is licensed under the MIT License.\n// License text available at https://opensource.org/licenses/MIT\n\n'use strict';\n\nvar EventEmitter = require('events').EventEmitter;\nvar NamespaceContext = require('./parser/nscontext');\nvar SOAPElement = require('./soapModel').SOAPElement;\nvar xmlBuilder = require('xmlbuilder');\nvar XMLHandler = require('./parser/xmlHandler');\n  \nclass Base extends EventEmitter {\n  constructor(wsdl, options) {\n    super();\n    this.wsdl = wsdl;\n    this._initializeOptions(options);\n    this.soapHeaders = [];\n    this.httpHeaders = {};\n    this.bodyAttributes = [];\n  }\n\n  addSoapHeader(value, qname) {\n    var header = new SOAPElement(value, qname, null);\n    return this.soapHeaders.push(header) - 1;\n  }\n\n  changeSoapHeader(index, value, qname) {\n    var header = new SOAPElement(value, qname, null);\n    this.soapHeaders[index] = header;\n  }\n\n\n  getSoapHeaders() {\n    return this.soapHeaders;\n  }\n\n  clearSoapHeaders() {\n    this.soapHeaders = [];\n  }\n\n  setHttpHeader(name, value) {\n    this.httpHeaders[name] = String(value);\n  }\n\n  addHttpHeader(name, value) {\n    var val = this.httpHeaders[name];\n    if (val != null) {\n      this.httpHeaders[name] = val + ', ' + value;\n    } else {\n      this.httpHeaders[name] = String(value);\n    }\n  }\n\n  getHttpHeaders() {\n    return this.httpHeaders;\n  }\n\n  clearHttpHeaders() {\n    this.httpHeaders = {};\n  }\n\n  _initializeOptions(options) {\n    options = options || {};\n    this.wsdl.options.attributesKey = options.attributesKey || 'attributes';\n    this.wsdl.options.envelopeKey = options.envelopeKey || 'soap';\n    this.wsdl.options.forceSoapVersion = options.forceSoapVersion;\n  }\n\n  static createSOAPEnvelope(prefix, nsURI) {\n    prefix = prefix || 'soap';\n    nsURI = nsURI || 'http://schemas.xmlsoap.org/soap/envelope/';\n    var doc = xmlBuilder.create(prefix + ':Envelope',\n      {version: '1.0', encoding: 'UTF-8', standalone: true});\n    doc.attribute('xmlns:' + prefix, nsURI);\n    let header = doc.element(prefix + ':Header');\n    let body = doc.element(prefix + ':Body');\n    return {\n      body: body,\n      header: header,\n      doc: doc\n    };\n  }\n\n  findElement(nsURI, name) {\n    var schemas = this.wsdl.definitions.schemas;\n    var schema = schemas[nsURI];\n    return schema && schema.elements[name];\n  }\n\n  createNamespaceContext(soapNsPrefix, soapNsURI) {\n    var nsContext = new NamespaceContext();\n    nsContext.declareNamespace(soapNsPrefix, soapNsURI);\n\n    var namespaces = this.wsdl.definitions.xmlns || {};\n    for (var prefix in namespaces) {\n      if (prefix === '')\n        continue;\n      var nsURI = namespaces[prefix];\n      switch (nsURI) {\n        case \"http://xml.apache.org/xml-soap\" : // apachesoap\n        case \"http://schemas.xmlsoap.org/wsdl/\" : // wsdl\n        case \"http://schemas.xmlsoap.org/wsdl/soap/\" : // wsdlsoap\n        case \"http://schemas.xmlsoap.org/wsdl/soap12/\": // wsdlsoap12\n        case \"http://schemas.xmlsoap.org/soap/encoding/\" : // soapenc\n        case \"http://www.w3.org/2001/XMLSchema\" : // xsd\n          continue;\n      }\n      if (~nsURI.indexOf('http://schemas.xmlsoap.org/'))\n        continue;\n      if (~nsURI.indexOf('http://www.w3.org/'))\n        continue;\n      if (~nsURI.indexOf('http://xml.apache.org/'))\n        continue;\n      nsContext.addNamespace(prefix, nsURI);\n    }\n    return nsContext;\n  }\n\n  addSoapHeadersToEnvelope(soapHeaderElement, xmlHandler) {\n    for (let i = 0, n = this.soapHeaders.length; i < n; i++) {\n      let soapHeader = this.soapHeaders[i];\n      let elementDescriptor;\n      if (typeof soapHeader.value === 'object') {\n        if (soapHeader.qname && soapHeader.qname.nsURI) {\n            let element = this.findElement(soapHeader.qname.nsURI, soapHeader.qname.name);\n            elementDescriptor =\n              element && element.describe(this.wsdl.definitions);\n        }\n        xmlHandler.jsonToXml(soapHeaderElement, null, elementDescriptor,\n          soapHeader.value);\n      } else { //soapHeader has XML value\n        XMLHandler.parseXml(soapHeaderElement, soapHeader.xml);\n      }\n    }\n  }\n\n}\n\nmodule.exports = Base;\n"],"file":"base.js"}