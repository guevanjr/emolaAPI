{"version":3,"sources":["../../src/parser/wsdl.js"],"names":["g","require","sax","HttpClient","fs","url","path","assert","stripBom","debug","debugInclude","_","selectn","utils","EMPTY_PREFIX","QName","Definitions","Schema","Types","Element","WSDL","constructor","definition","uri","options","content","_includesWsdl","WSDL_CACHE","_initializeOptions","load","callback","_loadAsyncOrSync","err","wsdl","loadSync","result","syncLoad","self","fromFunc","_fromXML","_fromServices","isLoaded","loadUpSchemas","call","e","processIncludes","name","schemas","definitions","s","postProcess","services","bindings","bindingName","binding","style","operations","topEls","topElements","methodName","input","inputName","$name","outputName","output","xmlnsInEnvelope","_xmlnsMap","process","nextTick","_originalIgnoredNamespaces","ignoredNamespaces","Array","isArray","namespaces","override","concat","forceSoapVersion","valueKey","xmlKey","wsdl_headers","wsdl_options","httpClient","request","ignoreBaseNameSpaces","NTLMSecurity","_processNextInclude","includes","include","shift","includePath","test","location","resolve","dirname","assign","staticLoad","push","undefined","namespace","mergeWith","a","b","merge","type","$targetNamespace","deepMerge","ns","schema","describeServices","service","describe","toXML","xml","xmlToObject","root","_parse","p","parser","trim","stack","types","text","onopentag","node","nsName","attrs","attributes","top","length","startElement","message","strict","parse","addChild","Error","f","onclosetag","endElement","ontext","str","write","close","xmlns","prefix","indexOf","fromCache","open","request_headers","request_options","readFile","response","statusCode","wsdlUri","get","body","openSync","loadSystemSchemas","xsdDir","join","__dirname","done","readdir","files","count","forEach","prototype","module","exports","destination","source"],"mappings":"AAAA;AACA;AACA;AACA;AAEA;;AAEA,IAAIA,CAAC,GAAGC,OAAO,CAAC,cAAD,CAAf;;AACA,IAAIC,GAAG,GAAGD,OAAO,CAAC,KAAD,CAAjB;;AACA,IAAIE,UAAU,GAAGF,OAAO,CAAC,WAAD,CAAxB;;AACA,IAAIG,EAAE,GAAGH,OAAO,CAAC,IAAD,CAAhB;;AACA,IAAII,GAAG,GAAGJ,OAAO,CAAC,KAAD,CAAjB;;AACA,IAAIK,IAAI,GAAGL,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIM,MAAM,GAAGN,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIO,QAAQ,GAAGP,OAAO,CAAC,cAAD,CAAtB;;AACA,IAAIQ,KAAK,GAAGR,OAAO,CAAC,OAAD,CAAP,CAAiB,kBAAjB,CAAZ;;AACA,IAAIS,YAAY,GAAGT,OAAO,CAAC,OAAD,CAAP,CAAiB,0BAAjB,CAAnB;;AACA,IAAIU,CAAC,GAAGV,OAAO,CAAC,QAAD,CAAf;;AACA,IAAIW,OAAO,GAAGX,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIY,KAAK,GAAGZ,OAAO,CAAC,UAAD,CAAnB;;AACA,IAAIa,YAAY,GAAGD,KAAK,CAACC,YAAzB;;AAEA,IAAIC,KAAK,GAAGd,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAIe,WAAW,GAAGf,OAAO,CAAC,oBAAD,CAAzB;;AACA,IAAIgB,MAAM,GAAGhB,OAAO,CAAC,cAAD,CAApB;;AACA,IAAIiB,KAAK,GAAGjB,OAAO,CAAC,cAAD,CAAnB;;AACA,IAAIkB,OAAO,GAAGlB,OAAO,CAAC,WAAD,CAArB;;AAEA,MAAMmB,IAAN,CAAW;AACTC,EAAAA,WAAW,CAACC,UAAD,EAAaC,GAAb,EAAkBC,OAAlB,EAA2B;AACpC,SAAKC,OAAL,GAAeH,UAAf;AACAf,IAAAA,MAAM,CAAC,KAAKkB,OAAL,IAAgB,IAAhB,KAAyB,OAAO,KAAKA,OAAZ,KAAwB,QAAxB,IAC9B,OAAO,KAAKA,OAAZ,KAAwB,QADnB,CAAD,EAEJ,mEAFI,CAAN;AAGA,SAAKF,GAAL,GAAWA,GAAX;AACA,SAAKG,aAAL,GAAqB,EAArB,CANoC,CAQpC;;AACA,SAAKC,UAAL,GAAkB,CAACH,OAAO,IAAI,EAAZ,EAAgBG,UAAhB,IAA8B,EAAhD;;AACA,SAAKC,kBAAL,CAAwBJ,OAAxB;AACD;;AAEDK,EAAAA,IAAI,CAACC,QAAD,EAAW;AACb,SAAKC,gBAAL,CAAsB,KAAtB,EAA6B,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AAChDH,MAAAA,QAAQ,CAACE,GAAD,EAAKC,IAAL,CAAR;AACD,KAFD;AAGD;;AAEDC,EAAAA,QAAQ,GAAG;AACT,QAAIC,MAAJ;;AACA,SAAKJ,gBAAL,CAAsB,IAAtB,EAA4B,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AAC7CE,MAAAA,MAAM,GAAGF,IAAT;AACH,KAFD,EAFS,CAKT;AACA;;;AACA,WAAOE,MAAP;AACD;;AAEDJ,EAAAA,gBAAgB,CAACK,QAAD,EAAWN,QAAX,EAAqB;AACnC,QAAIO,IAAI,GAAG,IAAX;AACA,QAAIf,UAAU,GAAG,KAAKG,OAAtB;AACA,QAAIa,QAAJ;;AACA,QAAI,OAAOhB,UAAP,KAAsB,QAA1B,EAAoC;AAClCA,MAAAA,UAAU,GAAGd,QAAQ,CAACc,UAAD,CAArB;AACAgB,MAAAA,QAAQ,GAAG,KAAKC,QAAhB;AACD,KAHD,MAIK,IAAI,OAAOjB,UAAP,KAAsB,QAA1B,EAAoC;AACvCgB,MAAAA,QAAQ,GAAG,KAAKE,aAAhB;AACD,KAVkC,CAYnC;;;AACAH,IAAAA,IAAI,CAACI,QAAL,GAAgB,IAAhB;;AAEA,QAAIC,aAAa,GAAG,SAAhBA,aAAgB,CAASN,QAAT,EAAmB;AACrC,UAAI;AACFE,QAAAA,QAAQ,CAACK,IAAT,CAAcN,IAAd,EAAoBf,UAApB;AACD,OAFD,CAEE,OAAOsB,CAAP,EAAU;AACV,eAAOd,QAAQ,CAACc,CAAD,CAAf;AACD;;AAEDP,MAAAA,IAAI,CAACQ,eAAL,CAAqBT,QAArB,EAA+B,UAASJ,GAAT,EAAc;AAC3C,YAAIc,IAAJ;;AACA,YAAId,GAAJ,EAAS;AACP,iBAAOF,QAAQ,CAACE,GAAD,CAAf;AACD;;AAED,YAAIe,OAAO,GAAGV,IAAI,CAACW,WAAL,CAAiBD,OAA/B;;AACA,aAAK,IAAIE,CAAT,IAAcF,OAAd,EAAuB;AACrBA,UAAAA,OAAO,CAACE,CAAD,CAAP,CAAWC,WAAX,CAAuBb,IAAI,CAACW,WAA5B;AACD;;AACD,YAAIG,QAAQ,GAAGd,IAAI,CAACc,QAAL,GAAgBd,IAAI,CAACW,WAAL,CAAiBG,QAAhD;;AACA,YAAIA,QAAJ,EAAc;AACZ,eAAK,IAAIF,CAAT,IAAcE,QAAd,EAAwB;AACtB,gBAAI;AACFA,cAAAA,QAAQ,CAACF,CAAD,CAAR,CAAYC,WAAZ,CAAwBb,IAAI,CAACW,WAA7B;AACD,aAFD,CAEE,OAAOhB,GAAP,EAAY;AACZ,qBAAOF,QAAQ,CAACE,GAAD,CAAf;AACD;AACF;AACF,SAnB0C,CAqB3C;AACA;;;AACA,YAAIoB,QAAQ,GAAGf,IAAI,CAACW,WAAL,CAAiBI,QAAhC;;AACA,aAAK,IAAIC,WAAT,IAAwBD,QAAxB,EAAkC;AAChC,cAAIE,OAAO,GAAGF,QAAQ,CAACC,WAAD,CAAtB;;AACA,cAAIC,OAAO,CAACC,KAAR,IAAiB,IAArB,EAA2B;AACzBD,YAAAA,OAAO,CAACC,KAAR,GAAgB,UAAhB;AACD;;AACD,cAAID,OAAO,CAACC,KAAR,KAAkB,UAAtB,EACE;AACF,cAAIC,UAAU,GAAGF,OAAO,CAACE,UAAzB;AACA,cAAIC,MAAM,GAAGH,OAAO,CAACI,WAAR,GAAsB,EAAnC;;AACA,eAAK,IAAIC,UAAT,IAAuBH,UAAvB,EAAmC;AACjC,gBAAIA,UAAU,CAACG,UAAD,CAAV,CAAuBC,KAA3B,EAAkC;AAChC,kBAAIC,SAAS,GAAGL,UAAU,CAACG,UAAD,CAAV,CAAuBC,KAAvB,CAA6BE,KAA7C;AACA,kBAAIC,UAAU,GAAG,EAAjB;AACA,kBAAIP,UAAU,CAACG,UAAD,CAAV,CAAuBK,MAA3B,EACED,UAAU,GAAGP,UAAU,CAACG,UAAD,CAAV,CAAuBK,MAAvB,CAA8BF,KAA3C;AACFL,cAAAA,MAAM,CAACI,SAAD,CAAN,GAAoB;AAClB,8BAAcF,UADI;AAElB,8BAAcI;AAFI,eAApB;AAID;AACF;AACF,SA7C0C,CA+C3C;;;AACA1B,QAAAA,IAAI,CAAC4B,eAAL,GAAuB5B,IAAI,CAAC6B,SAAL,EAAvB;AACApC,QAAAA,QAAQ,CAACE,GAAD,EAAMK,IAAN,CAAR;AACD,OAlDD;AAmDD,KA1DD;;AA4DA,QAAID,QAAJ,EAAc;AACZM,MAAAA,aAAa,CAAC,IAAD,CAAb;AACD,KAFD,MAEO;AACLyB,MAAAA,OAAO,CAACC,QAAR,CAAiB1B,aAAjB;AACD;AACF;;AAEDd,EAAAA,kBAAkB,CAACJ,OAAD,EAAU;AAC1B,SAAK6C,0BAAL,GAAkC,CAAC7C,OAAO,IAAI,EAAZ,EAAgB8C,iBAAlD;AACA,SAAK9C,OAAL,GAAe,EAAf;AAEA,QAAI8C,iBAAiB,GAAG9C,OAAO,GAAGA,OAAO,CAAC8C,iBAAX,GAA+B,IAA9D;;AAEA,QAAIA,iBAAiB,KAClBC,KAAK,CAACC,OAAN,CAAcF,iBAAiB,CAACG,UAAhC,KACD,OAAOH,iBAAiB,CAACG,UAAzB,KAAwC,QAFrB,CAArB,EAEqD;AACnD,UAAIH,iBAAiB,CAACI,QAAtB,EAAgC;AAC9B,aAAKlD,OAAL,CAAa8C,iBAAb,GAAiCA,iBAAiB,CAACG,UAAnD;AACD,OAFD,MAEO;AACL,aAAKjD,OAAL,CAAa8C,iBAAb,GACE,KAAKA,iBAAL,CAAuBK,MAAvB,CAA8BL,iBAAiB,CAACG,UAAhD,CADF;AAED;AACF,KATD,MASO;AACL,WAAKjD,OAAL,CAAa8C,iBAAb,GAAiC,KAAKA,iBAAtC;AACD;;AAED,SAAK9C,OAAL,CAAaoD,gBAAb,GAAgCpD,OAAO,CAACoD,gBAAxC;AAEA,SAAKpD,OAAL,CAAaqD,QAAb,GAAwBrD,OAAO,CAACqD,QAAR,IAAoB,KAAKA,QAAjD;AACA,SAAKrD,OAAL,CAAasD,MAAb,GAAsBtD,OAAO,CAACsD,MAAR,IAAkB,KAAKA,MAA7C,CAtB0B,CAwB1B;;AACA,SAAKtD,OAAL,CAAauD,YAAb,GAA4BvD,OAAO,CAACuD,YAApC;AACA,SAAKvD,OAAL,CAAawD,YAAb,GAA4BxD,OAAO,CAACwD,YAApC;;AAEA,QAAIxD,OAAO,CAACyD,UAAZ,EAAwB;AACtB,WAAKzD,OAAL,CAAayD,UAAb,GAA0BzD,OAAO,CAACyD,UAAlC;AACD;;AAED,QAAIzD,OAAO,CAAC0D,OAAZ,EAAqB;AACnB,WAAK1D,OAAL,CAAa0D,OAAb,GAAuB1D,OAAO,CAAC0D,OAA/B;AACD;;AAED,QAAIC,oBAAoB,GAAG3D,OAAO,GAAGA,OAAO,CAAC2D,oBAAX,GAAkC,IAApE;AACA,QAAIA,oBAAoB,KAAK,IAAzB,IACF,OAAOA,oBAAP,KAAgC,WADlC,EAEE,KAAK3D,OAAL,CAAa2D,oBAAb,GAAoCA,oBAApC,CAFF,KAIE,KAAK3D,OAAL,CAAa2D,oBAAb,GAAoC,KAAKA,oBAAzC;;AAEF,QAAI3D,OAAO,CAAC4D,YAAZ,EAA0B;AACxB,WAAK5D,OAAL,CAAa4D,YAAb,GAA4B5D,OAAO,CAAC4D,YAApC;AACD;AACF;;AAEDC,EAAAA,mBAAmB,CAACjD,QAAD,EAAWkD,QAAX,EAAqBxD,QAArB,EAA+B;AAChDpB,IAAAA,YAAY,CAAC,oBAAD,EAAuB4E,QAAvB,CAAZ;AACA,QAAIjD,IAAI,GAAG,IAAX;AAAA,QACEkD,OAAO,GAAGD,QAAQ,CAACE,KAAT,EADZ;AAAA,QAEEhE,OAFF;AAIA,QAAI,CAAC+D,OAAL,EACE,OAAOzD,QAAQ,EAAf,CAP8C,CAShD;;AACA,QAAI,CAACO,IAAI,CAACd,GAAV,EAAe;AACbc,MAAAA,IAAI,CAACd,GAAL,GAAS,EAAT;AACD;;AAED,QAAIkE,WAAJ;;AACA,QAAI,CAAC,WAAWC,IAAX,CAAgBrD,IAAI,CAACd,GAArB,CAAD,IAA8B,CAAC,WAAWmE,IAAX,CAAgBH,OAAO,CAACI,QAAxB,CAAnC,EAAsE;AACpEF,MAAAA,WAAW,GAAGnF,IAAI,CAACsF,OAAL,CAAatF,IAAI,CAACuF,OAAL,CAAaxD,IAAI,CAACd,GAAlB,CAAb,EAAqCgE,OAAO,CAACI,QAA7C,CAAd;AACD,KAFD,MAEO;AACLF,MAAAA,WAAW,GAAGpF,GAAG,CAACuF,OAAJ,CAAYvD,IAAI,CAACd,GAAjB,EAAsBgE,OAAO,CAACI,QAA9B,CAAd;AACD;;AAEDjF,IAAAA,YAAY,CAAC,cAAD,EAAiB6E,OAAjB,EAA0BE,WAA1B,CAAZ;AAEAjE,IAAAA,OAAO,GAAGb,CAAC,CAACmF,MAAF,CAAS,EAAT,EAAa,KAAKtE,OAAlB,CAAV,CAvBgD,CAwBhD;;AACAA,IAAAA,OAAO,CAAC8C,iBAAR,GAA4B,KAAKD,0BAAL,IAAmC,KAAK7C,OAAL,CAAa8C,iBAA5E;AACA9C,IAAAA,OAAO,CAACG,UAAR,GAAqB,KAAKA,UAA1B;;AAEA,QAAIoE,UAAU,GAAG,SAAbA,UAAa,CAAS3D,QAAT,EAAmBJ,GAAnB,EAAwBC,IAAxB,EAA8B;AAC7C,UAAID,GAAJ,EAAS;AACP,eAAOF,QAAQ,CAACE,GAAD,CAAf;AACD;;AAEDK,MAAAA,IAAI,CAACX,aAAL,CAAmBsE,IAAnB,CAAwB/D,IAAxB;;AAEA,UAAIA,IAAI,CAACe,WAAL,YAA4BhC,WAAhC,EAA6C;AAC3C;AACA,YAAIiF,SAAS,IAAIhE,IAAI,CAACe,WAAL,CAAiBD,OAAlC,EAA2C;AACzC,cAAIwC,OAAO,CAACW,SAAR,IAAqB,IAAzB,EAA+B;AAC7B;AACAjE,YAAAA,IAAI,CAACe,WAAL,CAAiBD,OAAjB,CAAyBwC,OAAO,CAACW,SAAjC,IAA8CjE,IAAI,CAACe,WAAL,CAAiBD,OAAjB,CAAyBkD,SAAzB,CAA9C;AACA,mBAAOhE,IAAI,CAACe,WAAL,CAAiBD,OAAjB,CAAyBkD,SAAzB,CAAP;AACD;AACF;;AACDtF,QAAAA,CAAC,CAACwF,SAAF,CAAY9D,IAAI,CAACW,WAAjB,EAA8Bf,IAAI,CAACe,WAAnC,EAAgD,UAAUoD,CAAV,EAAaC,CAAb,EAAgB;AAC9D,cAAID,CAAC,KAAKC,CAAV,EAAa;AACX,mBAAOD,CAAP;AACD;;AACD,iBAAQA,CAAC,YAAYnF,MAAd,GAAwBmF,CAAC,CAACE,KAAF,CAAQD,CAAR,EAAWd,OAAO,CAACgB,IAAR,KAAiB,SAA5B,CAAxB,GAAiEN,SAAxE;AACD,SALD;AAMD,OAfD,MAeO;AACL5D,QAAAA,IAAI,CAACW,WAAL,CAAiBD,OAAjB,CAAyBwC,OAAO,CAACW,SAAR,IACzBjE,IAAI,CAACe,WAAL,CAAiBwD,gBADjB,IAEEC,SAAS,CAACpE,IAAI,CAACW,WAAL,CAAiBD,OAAjB,CAAyBwC,OAAO,CAACW,SAAR,IACnCjE,IAAI,CAACe,WAAL,CAAiBwD,gBADP,CAAD,EAC2BvE,IAAI,CAACe,WADhC,CAFX;AAID;;AACDX,MAAAA,IAAI,CAACgD,mBAAL,CAAyBjD,QAAzB,EAAmCkD,QAAnC,EAA6C,UAAUtD,GAAV,EAAe;AAC1DF,QAAAA,QAAQ,CAACE,GAAD,CAAR;AACD,OAFD;AAGD,KA/BD;;AAiCA,QAAII,QAAJ,EAAc;AACZ,UAAIH,IAAI,GAAGb,IAAI,CAACc,QAAL,CAAcuD,WAAd,EAA2BjE,OAA3B,CAAX;AACAuE,MAAAA,UAAU,CAAC,IAAD,EAAO,IAAP,EAAa9D,IAAb,CAAV;AACD,KAHD,MAGO;AACLb,MAAAA,IAAI,CAACS,IAAL,CAAU4D,WAAV,EAAuBjE,OAAvB,EAAgC,UAAUQ,GAAV,EAAeC,IAAf,EAAqB;AACnD8D,QAAAA,UAAU,CAAC,KAAD,EAAQ/D,GAAR,EAAaC,IAAb,CAAV;AACD,OAFD;AAID;AAEF;;AAEDY,EAAAA,eAAe,CAACT,QAAD,EAAWN,QAAX,EAAqB;AAClC,QAAIiB,OAAO,GAAG,KAAKC,WAAL,CAAiBD,OAA/B;AAAA,QACEuC,QAAQ,GAAG,EADb;;AAGA,SAAK,IAAIoB,EAAT,IAAe3D,OAAf,EAAwB;AACtB,UAAI4D,MAAM,GAAG5D,OAAO,CAAC2D,EAAD,CAApB;AACApB,MAAAA,QAAQ,GAAGA,QAAQ,CAACX,MAAT,CAAgBgC,MAAM,CAACrB,QAAP,IAAmB,EAAnC,CAAX;AACD;;AAED,SAAKD,mBAAL,CAAyBjD,QAAzB,EAAmCkD,QAAnC,EAA6CxD,QAA7C;AACD;;AAED8E,EAAAA,gBAAgB,GAAG;AACjB,QAAIzD,QAAQ,GAAG,EAAf;;AACA,SAAK,IAAIL,IAAT,IAAiB,KAAKK,QAAtB,EAAgC;AAC9B,UAAI0D,OAAO,GAAG,KAAK1D,QAAL,CAAcL,IAAd,CAAd;AACAK,MAAAA,QAAQ,CAACL,IAAD,CAAR,GAAiB+D,OAAO,CAACC,QAAR,CAAiB,KAAK9D,WAAtB,CAAjB;AACD;;AACD,WAAOG,QAAP;AACD;;AAED4D,EAAAA,KAAK,GAAG;AACN,WAAO,KAAKC,GAAL,IAAY,EAAnB;AACD;;AAEDC,EAAAA,WAAW,CAACD,GAAD,EAAM;AACf,WAAOE,IAAP;AACD;;AAEDC,EAAAA,MAAM,CAACH,GAAD,EAAM;AACV,QAAI3E,IAAI,GAAG,IAAX;AAAA,QACE+E,CAAC,GAAGlH,GAAG,CAACmH,MAAJ,CAAW,IAAX,EAAiB;AAACC,MAAAA,IAAI,EAAE;AAAP,KAAjB,CADN;AAAA,QAEEC,KAAK,GAAG,EAFV;AAAA,QAGEL,IAAI,GAAG,IAHT;AAAA,QAIEM,KAAK,GAAG,IAJV;AAAA,QAKEb,MAAM,GAAG,IALX;AAAA,QAMEc,IAAI,GAAG,EANT;AAAA,QAOEjG,OAAO,GAAGa,IAAI,CAACb,OAPjB;;AASA4F,IAAAA,CAAC,CAACM,SAAF,GAAc,UAASC,IAAT,EAAe;AAC3BlH,MAAAA,KAAK,CAAC,mBAAD,EAAsBkH,IAAtB,CAAL;AACAF,MAAAA,IAAI,GAAG,EAAP,CAF2B,CAEhB;;AACX,UAAIG,MAAM,GAAGD,IAAI,CAAC7E,IAAlB;AACA,UAAI+E,KAAK,GAAGF,IAAI,CAACG,UAAjB;AAEA,UAAIC,GAAG,GAAGR,KAAK,CAACA,KAAK,CAACS,MAAN,GAAe,CAAhB,CAAf;AACA,UAAIlF,IAAJ;;AACA,UAAIiF,GAAJ,EAAS;AACP,YAAI;AACFA,UAAAA,GAAG,CAACE,YAAJ,CAAiBV,KAAjB,EAAwBK,MAAxB,EAAgCC,KAAhC,EAAuCrG,OAAvC;AACD,SAFD,CAEE,OAAOoB,CAAP,EAAU;AACVnC,UAAAA,KAAK,CAAC,iBAAD,EAAoBmC,CAAC,CAACsF,OAAtB,CAAL;;AACA,cAAI7F,IAAI,CAACb,OAAL,CAAa2G,MAAjB,EAAyB;AACvB,kBAAMvF,CAAN;AACD,WAFD,MAEO;AACL2E,YAAAA,KAAK,CAACvB,IAAN,CAAW,IAAI7E,OAAJ,CAAYyG,MAAZ,EAAoBC,KAApB,EAA2BrG,OAA3B,CAAX;AACD;AACF;AACF,OAXD,MAWO;AACLsB,QAAAA,IAAI,GAAG/B,KAAK,CAACqH,KAAN,CAAYR,MAAZ,EAAoB9E,IAA3B;;AACA,YAAIA,IAAI,KAAK,aAAb,EAA4B;AAC1BoE,UAAAA,IAAI,GAAG,IAAIlG,WAAJ,CAAgB4G,MAAhB,EAAwBC,KAAxB,EAA+BrG,OAA/B,CAAP;AACA+F,UAAAA,KAAK,CAACvB,IAAN,CAAWkB,IAAX;AACD,SAHD,MAGO,IAAIpE,IAAI,KAAK,QAAb,EAAuB;AAC5B;AACA;AACAoE,UAAAA,IAAI,GAAG,IAAIlG,WAAJ,CAAgB,aAAhB,EAA+B,EAA/B,EAAmC,EAAnC,CAAP;AACAwG,UAAAA,KAAK,GAAG,IAAItG,KAAJ,CAAU,OAAV,EAAmB,EAAnB,EAAuB,EAAvB,CAAR;AACAyF,UAAAA,MAAM,GAAG,IAAI1F,MAAJ,CAAW2G,MAAX,EAAmBC,KAAnB,EAA0BrG,OAA1B,CAAT;AACAgG,UAAAA,KAAK,CAACa,QAAN,CAAe1B,MAAf;AACAO,UAAAA,IAAI,CAACmB,QAAL,CAAcb,KAAd;AACAD,UAAAA,KAAK,CAACvB,IAAN,CAAWW,MAAX;AACD,SATM,MASA;AACL,gBAAM,IAAI2B,KAAJ,CAAUtI,CAAC,CAACuI,CAAF,CAAI,gDAAJ,CAAV,CAAN;AACD;AACF;AACF,KArCD;;AAuCAnB,IAAAA,CAAC,CAACoB,UAAF,GAAe,UAAS1F,IAAT,EAAe;AAC5BrC,MAAAA,KAAK,CAAC,iBAAD,EAAoBqC,IAApB,CAAL;AACA,UAAIiF,GAAG,GAAGR,KAAK,CAACA,KAAK,CAACS,MAAN,GAAe,CAAhB,CAAf;AACAzH,MAAAA,MAAM,CAACwH,GAAD,EAAM,0BAA0BjF,IAAhC,CAAN;;AAEA,UAAI2E,IAAJ,EAAU;AACRM,QAAAA,GAAG,CAAC1F,IAAI,CAACb,OAAL,CAAaqD,QAAd,CAAH,GAA6B4C,IAA7B;AACAA,QAAAA,IAAI,GAAG,EAAP;AACD;;AACDM,MAAAA,GAAG,CAACU,UAAJ,CAAelB,KAAf,EAAsBzE,IAAtB;AACD,KAVD;;AAYAsE,IAAAA,CAAC,CAACsB,MAAF,GAAW,UAASC,GAAT,EAAc;AACvBlB,MAAAA,IAAI,GAAGA,IAAI,GAAGkB,GAAd;AACD,KAFD;;AAIAlI,IAAAA,KAAK,CAAC,cAAD,EAAiBuG,GAAjB,CAAL;AACAI,IAAAA,CAAC,CAACwB,KAAF,CAAQ5B,GAAR,EAAa6B,KAAb;AAEA,WAAO3B,IAAP;AACD;;AAED3E,EAAAA,QAAQ,CAACyE,GAAD,EAAM;AACZ,SAAKhE,WAAL,GAAmB,KAAKmE,MAAL,CAAYH,GAAZ,CAAnB;AACA,SAAKA,GAAL,GAAWA,GAAX;AACD;;AAEDxE,EAAAA,aAAa,CAACW,QAAD,EAAW,CACvB;;AAEDe,EAAAA,SAAS,GAAG;AACV,QAAI4E,KAAK,GAAG,KAAK9F,WAAL,CAAiB8F,KAA7B;AACA,QAAIH,GAAG,GAAG,EAAV;;AACA,SAAK,IAAII,MAAT,IAAmBD,KAAnB,EAA0B;AACxB,UAAIC,MAAM,KAAK,EAAX,IAAiBA,MAAM,KAAKjI,YAAhC,EACE;AACF,UAAI4F,EAAE,GAAGoC,KAAK,CAACC,MAAD,CAAd;;AACA,cAAQrC,EAAR;AACE,aAAK,gCAAL,CADF,CAC0C;;AACxC,aAAK,kCAAL,CAFF,CAE4C;;AAC1C,aAAK,uCAAL,CAHF,CAGiD;;AAC/C,aAAK,yCAAL,CAJF,CAIkD;;AAChD,aAAK,2CAAL,CALF,CAKqD;;AACnD,aAAK,kCAAL;AAA0C;AACxC;AAPJ;;AASA,UAAI,CAACA,EAAE,CAACsC,OAAH,CAAW,6BAAX,CAAL,EACE;AACF,UAAI,CAACtC,EAAE,CAACsC,OAAH,CAAW,oBAAX,CAAL,EACE;AACF,UAAI,CAACtC,EAAE,CAACsC,OAAH,CAAW,wBAAX,CAAL,EACE;AACFL,MAAAA,GAAG,IAAI,YAAYI,MAAZ,GAAqB,IAArB,GAA4BrC,EAA5B,GAAiC,GAAxC;AACD;;AACD,WAAOiC,GAAP;AACD;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACa,SAAJ9G,IAAI,CAACN,GAAD,EAAMC,OAAN,EAAeM,QAAf,EAAyB;AAClC,QAAImH,SAAJ,EACEtH,UADF;;AAGA,QAAI,OAAOH,OAAP,KAAmB,UAAvB,EAAmC;AACjCM,MAAAA,QAAQ,GAAGN,OAAX;AACAA,MAAAA,OAAO,GAAG,EAAV;AACD;;AAEDG,IAAAA,UAAU,GAAGH,OAAO,CAACG,UAArB;;AAEA,QAAIsH,SAAS,GAAGtH,UAAU,CAACJ,GAAD,CAA1B,EAAiC;AAC/B;AACN;AACA;AACA;AACA;AACM,UAAG0H,SAAS,CAACxG,QAAb,EAAsB;AACpB,eAAOX,QAAQ,CAACa,IAAT,CAAcsG,SAAd,EAAyB,IAAzB,EAA+BA,SAA/B,CAAP;AACD;AACF;;AAED,WAAO7H,IAAI,CAAC8H,IAAL,CAAU3H,GAAV,EAAeC,OAAf,EAAwBM,QAAxB,CAAP;AACD;;AAEU,SAAJoH,IAAI,CAAC3H,GAAD,EAAMC,OAAN,EAAeM,QAAf,EAAyB;AAClC,QAAI,OAAON,OAAP,KAAmB,UAAvB,EAAmC;AACjCM,MAAAA,QAAQ,GAAGN,OAAX;AACAA,MAAAA,OAAO,GAAG,EAAV;AACD,KAJiC,CAMlC;;;AACA,QAAIG,UAAU,GAAGH,OAAO,CAACG,UAAR,IAAsB,EAAvC;AACA,QAAIwH,eAAe,GAAG3H,OAAO,CAACuD,YAA9B;AACA,QAAIqE,eAAe,GAAG5H,OAAO,CAACwD,YAA9B;AAEAvE,IAAAA,KAAK,CAAC,oDAAD,EAAuD0I,eAAvD,EAAwEC,eAAxE,CAAL;AACA,QAAInH,IAAJ;AACA,QAAIgH,SAAS,GAAGtH,UAAU,CAACJ,GAAD,CAA1B;AACA;AACJ;AACA;AACA;;AACI,QAAI0H,SAAS,IAAI,CAACA,SAAS,CAACxG,QAA5B,EAAsC;AACpCwG,MAAAA,SAAS,CAACpH,IAAV,CAAeC,QAAf;AACD,KAFD,MAGK,IAAI,CAAC,WAAW4D,IAAX,CAAgBnE,GAAhB,CAAL,EAA2B;AAC9Bd,MAAAA,KAAK,CAAC,kBAAD,EAAqBc,GAArB,CAAL;AACAnB,MAAAA,EAAE,CAACiJ,QAAH,CAAY9H,GAAZ,EAAiB,MAAjB,EAAyB,UAASS,GAAT,EAAcV,UAAd,EAA0B;AACjD,YAAIU,GAAJ,EAAS;AACPF,UAAAA,QAAQ,CAACE,GAAD,CAAR;AACD,SAFD,MAGK;AACHC,UAAAA,IAAI,GAAG,IAAIb,IAAJ,CAASE,UAAT,EAAqBC,GAArB,EAA0BC,OAA1B,CAAP;AACAG,UAAAA,UAAU,CAACJ,GAAD,CAAV,GAAkBU,IAAlB;AACAA,UAAAA,IAAI,CAACN,UAAL,GAAkBA,UAAlB;AACAM,UAAAA,IAAI,CAACJ,IAAL,CAAUC,QAAV;AACD;AACF,OAVD;AAWD,KAbI,MAcA;AACH,UAAImD,UAAU,GAAGzD,OAAO,CAACyD,UAAR,IAAsB,IAAI9E,UAAJ,CAAeqB,OAAf,CAAvC;AACAyD,MAAAA,UAAU,CAACC,OAAX,CAAmB3D,GAAnB,EAAwB;AAAK;AAA7B,QACE,UAASS,GAAT,EAAcsH,QAAd,EAAwBhI,UAAxB,EAAoC;AAClC,YAAIU,GAAJ,EAAS;AACPF,UAAAA,QAAQ,CAACE,GAAD,CAAR;AACD,SAFD,MAEO,IAAIsH,QAAQ,IAAIA,QAAQ,CAACC,UAAT,KAAwB,GAAxC,EAA6C;AAClD,gBAAMC,OAAO,GAAG7I,CAAC,CAAC8I,GAAF,CAAMH,QAAN,EAAgB,kBAAhB,EAAoC/H,GAApC,CAAhB;;AACAU,UAAAA,IAAI,GAAG,IAAIb,IAAJ,CAASE,UAAT,EAAqBkI,OAArB,EAA8BhI,OAA9B,CAAP;AACAG,UAAAA,UAAU,CAAC6H,OAAD,CAAV,GAAsBvH,IAAtB;AACAA,UAAAA,IAAI,CAACN,UAAL,GAAkBA,UAAlB;AACAM,UAAAA,IAAI,CAACJ,IAAL,CAAUC,QAAV;AACD,SANM,MAMA;AACLA,UAAAA,QAAQ,CAAC,IAAIwG,KAAJ,CAAUtI,CAAC,CAACuI,CAAF,CAAI,4CACrB,0BADiB,EACWhH,GADX,EACgB+H,QAAQ,CAACC,UADzB,EACqCD,QAAQ,CAACI,IAD9C,CAAV,CAAD,CAAR;AAED;AACF,OAdH,EAcKP,eAdL,EAcsBC,eAdtB;AAeD;;AAED,WAAOnH,IAAP;AACD;;AAEc,SAARC,QAAQ,CAACX,GAAD,EAAMC,OAAN,EAAe;AAC5B,QAAIyH,SAAJ,EACEtH,UADF;;AAGA,QAAI,CAACH,OAAL,EAAc;AACZA,MAAAA,OAAO,GAAG,EAAV;AACD;;AAEDG,IAAAA,UAAU,GAAGH,OAAO,CAACG,UAArB;;AAEA,QAAIsH,SAAS,GAAGtH,UAAU,CAACJ,GAAD,CAA1B,EAAiC;AAC/B;AACN;AACA;AACA;AACA;AACM,UAAG0H,SAAS,CAACxG,QAAb,EAAsB;AACpB,eAAOwG,SAAP;AACD;AACF;;AAED,WAAO7H,IAAI,CAACuI,QAAL,CAAcpI,GAAd,EAAmBC,OAAnB,CAAP;AACD;;AAEc,SAARmI,QAAQ,CAACpI,GAAD,EAAMC,OAAN,EAAe;AAC5B,QAAI,CAACA,OAAL,EAAc;AACZA,MAAAA,OAAO,GAAG,EAAV;AACD,KAH2B,CAK5B;;;AACA,QAAIG,UAAU,GAAGH,OAAO,CAACG,UAAR,IAAsB,EAAvC;AACA,QAAIwH,eAAe,GAAG3H,OAAO,CAACuD,YAA9B;AACA,QAAIqE,eAAe,GAAG5H,OAAO,CAACwD,YAA9B;AAEAvE,IAAAA,KAAK,CAAC,oDAAD,EAAuD0I,eAAvD,EAAwEC,eAAxE,CAAL;AACA,QAAInH,IAAJ;AACA,QAAIgH,SAAS,GAAGtH,UAAU,CAACJ,GAAD,CAA1B;AACA;AACJ;AACA;AACA;AACA;;AACI,QAAI0H,SAAS,IAAI,CAACA,SAAS,CAACxG,QAA5B,EAAsC;AACpCR,MAAAA,IAAI,GAAGgH,SAAS,CAAC/G,QAAV,EAAP;AACD,KAFD,MAEO;AACL,YAAMX,GAAG,GAAC,gGAAV;AACD;;AAED,WAAOU,IAAP;AACD;;AAEuB,SAAjB2H,iBAAiB,CAAC9H,QAAD,EAAW;AACjC,QAAI+H,MAAM,GAAGvJ,IAAI,CAACwJ,IAAL,CAAUC,SAAV,EAAqB,aAArB,CAAb;AACA,QAAIC,IAAI,GAAG,KAAX;AACA5J,IAAAA,EAAE,CAAC6J,OAAH,CAAWJ,MAAX,EAAmB,UAAS7H,GAAT,EAAckI,KAAd,EAAqB;AACtC,UAAIlI,GAAJ,EAAS,OAAOF,QAAQ,CAACE,GAAD,CAAf;AACT,UAAIe,OAAO,GAAG,EAAd;AACA,UAAIoH,KAAK,GAAGD,KAAK,CAAClC,MAAlB;AACAkC,MAAAA,KAAK,CAACE,OAAN,CAAc,UAAS7B,CAAT,EAAY;AACxBnH,QAAAA,IAAI,CAAC8H,IAAL,CAAU5I,IAAI,CAACwJ,IAAL,CAAUD,MAAV,EAAkBtB,CAAlB,CAAV,EAAgC,EAAhC,EAAoC,UAASvG,GAAT,EAAcC,IAAd,EAAoB;AACtD,cAAI+H,IAAJ,EAAU;AACVG,UAAAA,KAAK;;AACL,cAAInI,GAAJ,EAAS;AACPgI,YAAAA,IAAI,GAAG,IAAP;AACA,mBAAOlI,QAAQ,CAACE,GAAD,CAAf;AACD;;AACD,eAAK,IAAIiB,CAAT,IAAchB,IAAI,CAACe,WAAL,CAAiBD,OAA/B,EAAwC;AACtCA,YAAAA,OAAO,CAACE,CAAD,CAAP,GAAahB,IAAI,CAACe,WAAL,CAAiBD,OAAjB,CAAyBE,CAAzB,CAAb;AACD;;AACD,cAAIkH,KAAK,KAAK,CAAd,EAAiB;AACfH,YAAAA,IAAI,GAAG,IAAP;AACAlI,YAAAA,QAAQ,CAAC,IAAD,EAAOiB,OAAP,CAAR;AACD;AACF,SAdD;AAeD,OAhBD;AAiBD,KArBD;AAsBD;;AAhiBQ;;AAmiBX3B,IAAI,CAACiJ,SAAL,CAAe/F,iBAAf,GAAmC,CAAC,iBAAD,EAAoB,gBAApB,CAAnC;AACAlD,IAAI,CAACiJ,SAAL,CAAelF,oBAAf,GAAsC,KAAtC;AACA/D,IAAI,CAACiJ,SAAL,CAAexF,QAAf,GAA0B,QAA1B;AACAzD,IAAI,CAACiJ,SAAL,CAAevF,MAAf,GAAwB,MAAxB;AAEAwF,MAAM,CAACC,OAAP,GAAiBnJ,IAAjB;;AAEA,SAASqF,SAAT,CAAmB+D,WAAnB,EAAgCC,MAAhC,EAAwC;AACtC,SAAO9J,CAAC,CAACwF,SAAF,CAAYqE,WAAW,IAAI,EAA3B,EAA+BC,MAA/B,EAAuC,UAASrE,CAAT,EAAYC,CAAZ,EAAe;AAC3D,WAAO1F,CAAC,CAAC6D,OAAF,CAAU4B,CAAV,IAAeA,CAAC,CAACzB,MAAF,CAAS0B,CAAT,CAAf,GAA6BJ,SAApC;AACD,GAFM,CAAP;AAGD","sourcesContent":["// Copyright IBM Corp. 2016,2019. All Rights Reserved.\n// Node module: strong-soap\n// This file is licensed under the MIT License.\n// License text available at https://opensource.org/licenses/MIT\n\n'use strict';\n\nvar g = require('../globalize');\nvar sax = require('sax');\nvar HttpClient = require('./../http');\nvar fs = require('fs');\nvar url = require('url');\nvar path = require('path');\nvar assert = require('assert');\nvar stripBom = require('../strip-bom');\nvar debug = require('debug')('strong-soap:wsdl');\nvar debugInclude = require('debug')('strong-soap:wsdl:include');\nvar _ = require('lodash');\nvar selectn = require('selectn');\nvar utils = require('./helper');\nvar EMPTY_PREFIX = utils.EMPTY_PREFIX;\n\nvar QName = require('./qname');\nvar Definitions = require('./wsdl/definitions');\nvar Schema = require('./xsd/schema');\nvar Types = require('./wsdl/types');\nvar Element = require('./element');\n\nclass WSDL {\n  constructor(definition, uri, options) {\n    this.content = definition;\n    assert(this.content != null && (typeof this.content === 'string' ||\n      typeof this.content === 'object'),\n      'WSDL constructor takes either an XML string or definitions object');\n    this.uri = uri;\n    this._includesWsdl = [];\n\n    // initialize WSDL cache\n    this.WSDL_CACHE = (options || {}).WSDL_CACHE || {};\n    this._initializeOptions(options);\n  }\n\n  load(callback) {\n    this._loadAsyncOrSync(false, function (err, wsdl) {\n      callback(err,wsdl);\n    });\n  }\n\n  loadSync() {\n    var result;\n    this._loadAsyncOrSync(true, function (err, wsdl) {\n        result = wsdl;\n    });\n    // This is not intuitive but works as the load function and its callback all are executed before the\n    // loadSync function returns. The outcome here is that the following result is always set correctly.\n    return result;\n  }\n\n  _loadAsyncOrSync(syncLoad, callback) {\n    var self = this;\n    var definition = this.content;\n    let fromFunc;\n    if (typeof definition === 'string') {\n      definition = stripBom(definition);\n      fromFunc = this._fromXML;\n    }\n    else if (typeof definition === 'object') {\n      fromFunc = this._fromServices;\n    }\n\n    // register that this WSDL has started loading\n    self.isLoaded = true;\n\n    var loadUpSchemas = function(syncLoad) {\n      try {\n        fromFunc.call(self, definition);\n      } catch (e) {\n        return callback(e);\n      }\n\n      self.processIncludes(syncLoad, function(err) {\n        var name;\n        if (err) {\n          return callback(err);\n        }\n\n        var schemas = self.definitions.schemas;\n        for (let s in schemas) {\n          schemas[s].postProcess(self.definitions);\n        }\n        var services = self.services = self.definitions.services;\n        if (services) {\n          for (let s in services) {\n            try {\n              services[s].postProcess(self.definitions);\n            } catch (err) {\n              return callback(err);\n            }\n          }\n        }\n\n        // for document style, for every binding, prepare input message\n        // element name to (methodName, output message element name) mapping\n        var bindings = self.definitions.bindings;\n        for (var bindingName in bindings) {\n          var binding = bindings[bindingName];\n          if (binding.style == null) {\n            binding.style = 'document';\n          }\n          if (binding.style !== 'document')\n            continue;\n          var operations = binding.operations;\n          var topEls = binding.topElements = {};\n          for (var methodName in operations) {\n            if (operations[methodName].input) {\n              var inputName = operations[methodName].input.$name;\n              var outputName = \"\";\n              if (operations[methodName].output)\n                outputName = operations[methodName].output.$name;\n              topEls[inputName] = {\n                \"methodName\": methodName,\n                \"outputName\": outputName\n              };\n            }\n          }\n        }\n\n        // prepare soap envelope xmlns definition string\n        self.xmlnsInEnvelope = self._xmlnsMap();\n        callback(err, self);\n      });\n    }\n\n    if (syncLoad) {\n      loadUpSchemas(true);\n    } else {\n      process.nextTick(loadUpSchemas);\n    }\n  }\n\n  _initializeOptions(options) {\n    this._originalIgnoredNamespaces = (options || {}).ignoredNamespaces;\n    this.options = {};\n\n    var ignoredNamespaces = options ? options.ignoredNamespaces : null;\n\n    if (ignoredNamespaces &&\n      (Array.isArray(ignoredNamespaces.namespaces) ||\n      typeof ignoredNamespaces.namespaces === 'string')) {\n      if (ignoredNamespaces.override) {\n        this.options.ignoredNamespaces = ignoredNamespaces.namespaces;\n      } else {\n        this.options.ignoredNamespaces =\n          this.ignoredNamespaces.concat(ignoredNamespaces.namespaces);\n      }\n    } else {\n      this.options.ignoredNamespaces = this.ignoredNamespaces;\n    }\n\n    this.options.forceSoapVersion = options.forceSoapVersion;\n\n    this.options.valueKey = options.valueKey || this.valueKey;\n    this.options.xmlKey = options.xmlKey || this.xmlKey;\n\n    // Allow any request headers to keep passing through\n    this.options.wsdl_headers = options.wsdl_headers;\n    this.options.wsdl_options = options.wsdl_options;\n\n    if (options.httpClient) {\n      this.options.httpClient = options.httpClient;\n    }\n    \n    if (options.request) {\n      this.options.request = options.request;\n    }\n\n    var ignoreBaseNameSpaces = options ? options.ignoreBaseNameSpaces : null;\n    if (ignoreBaseNameSpaces !== null &&\n      typeof ignoreBaseNameSpaces !== 'undefined')\n      this.options.ignoreBaseNameSpaces = ignoreBaseNameSpaces;\n    else\n      this.options.ignoreBaseNameSpaces = this.ignoreBaseNameSpaces;\n\n    if (options.NTLMSecurity) {\n      this.options.NTLMSecurity = options.NTLMSecurity;\n    }\n  }\n\n  _processNextInclude(syncLoad, includes, callback) {\n    debugInclude('includes/imports: ', includes);\n    var self = this,\n      include = includes.shift(),\n      options;\n\n    if (!include)\n      return callback();\n\n    // if undefined treat as \"\" to make path.dirname return '.' as errors on non string below\n    if (!self.uri) {\n      self.uri='';\n    }\n\n    var includePath;\n    if (!/^https?:/.test(self.uri) && !/^https?:/.test(include.location)) {\n      includePath = path.resolve(path.dirname(self.uri), include.location);\n    } else {\n      includePath = url.resolve(self.uri, include.location);\n    }\n\n    debugInclude('Processing: ', include, includePath);\n\n    options = _.assign({}, this.options);\n    // follow supplied ignoredNamespaces option\n    options.ignoredNamespaces = this._originalIgnoredNamespaces || this.options.ignoredNamespaces;\n    options.WSDL_CACHE = this.WSDL_CACHE;\n\n    var staticLoad = function(syncLoad, err, wsdl) {\n      if (err) {\n        return callback(err);\n      }\n\n      self._includesWsdl.push(wsdl);\n\n      if (wsdl.definitions instanceof Definitions) {\n        // Set namespace for included schema that does not have targetNamespace\n        if (undefined in wsdl.definitions.schemas) {\n          if (include.namespace != null) {\n            // If A includes B and B includes C, B & C can both have no targetNamespace\n            wsdl.definitions.schemas[include.namespace] = wsdl.definitions.schemas[undefined];\n            delete wsdl.definitions.schemas[undefined];\n          }\n        }\n        _.mergeWith(self.definitions, wsdl.definitions, function (a, b) {\n          if (a === b) {\n            return a;\n          }\n          return (a instanceof Schema) ? a.merge(b, include.type === 'include') : undefined;\n        });\n      } else {\n        self.definitions.schemas[include.namespace ||\n        wsdl.definitions.$targetNamespace] =\n          deepMerge(self.definitions.schemas[include.namespace ||\n          wsdl.definitions.$targetNamespace], wsdl.definitions);\n      }\n      self._processNextInclude(syncLoad, includes, function (err) {\n        callback(err);\n      });\n    };\n\n    if (syncLoad) {\n      var wsdl = WSDL.loadSync(includePath, options);\n      staticLoad(true, null, wsdl);\n    } else {\n      WSDL.load(includePath, options, function (err, wsdl) {\n        staticLoad(false, err, wsdl);\n      });\n\n    }\n\n  }\n\n  processIncludes(syncLoad, callback) {\n    var schemas = this.definitions.schemas,\n      includes = [];\n\n    for (var ns in schemas) {\n      var schema = schemas[ns];\n      includes = includes.concat(schema.includes || []);\n    }\n\n    this._processNextInclude(syncLoad, includes, callback);\n  }\n\n  describeServices() {\n    var services = {};\n    for (var name in this.services) {\n      var service = this.services[name];\n      services[name] = service.describe(this.definitions);\n    }\n    return services;\n  }\n\n  toXML() {\n    return this.xml || '';\n  }\n\n  xmlToObject(xml) {\n    return root;\n  }\n\n  _parse(xml) {\n    var self = this,\n      p = sax.parser(true, {trim: true}),\n      stack = [],\n      root = null,\n      types = null,\n      schema = null,\n      text = '',\n      options = self.options;\n\n    p.onopentag = function(node) {\n      debug('Start element: %j', node);\n      text = ''; // reset text\n      var nsName = node.name;\n      var attrs = node.attributes;\n\n      var top = stack[stack.length - 1];\n      var name;\n      if (top) {\n        try {\n          top.startElement(stack, nsName, attrs, options);\n        } catch (e) {\n          debug(\"WSDL error: %s \", e.message);\n          if (self.options.strict) {\n            throw e;\n          } else {\n            stack.push(new Element(nsName, attrs, options));\n          }\n        }\n      } else {\n        name = QName.parse(nsName).name;\n        if (name === 'definitions') {\n          root = new Definitions(nsName, attrs, options);\n          stack.push(root);\n        } else if (name === 'schema') {\n          // Shim a structure in here to allow the proper objects to be\n          // created when merging back.\n          root = new Definitions('definitions', {}, {});\n          types = new Types('types', {}, {});\n          schema = new Schema(nsName, attrs, options);\n          types.addChild(schema);\n          root.addChild(types);\n          stack.push(schema);\n        } else {\n          throw new Error(g.f('Unexpected root element of {{WSDL}} or include'));\n        }\n      }\n    };\n\n    p.onclosetag = function(name) {\n      debug('End element: %s', name);\n      var top = stack[stack.length - 1];\n      assert(top, 'Unmatched close tag: ' + name);\n\n      if (text) {\n        top[self.options.valueKey] = text;\n        text = '';\n      }\n      top.endElement(stack, name);\n    };\n\n    p.ontext = function(str) {\n      text = text + str;\n    }\n\n    debug('WSDL xml: %s', xml);\n    p.write(xml).close();\n\n    return root;\n  };\n\n  _fromXML(xml) {\n    this.definitions = this._parse(xml);\n    this.xml = xml;\n  }\n\n  _fromServices(services) {\n  }\n\n  _xmlnsMap() {\n    var xmlns = this.definitions.xmlns;\n    var str = '';\n    for (var prefix in xmlns) {\n      if (prefix === '' || prefix === EMPTY_PREFIX)\n        continue;\n      var ns = xmlns[prefix];\n      switch (ns) {\n        case \"http://xml.apache.org/xml-soap\" : // apachesoap\n        case \"http://schemas.xmlsoap.org/wsdl/\" : // wsdl\n        case \"http://schemas.xmlsoap.org/wsdl/soap/\" : // wsdlsoap\n        case \"http://schemas.xmlsoap.org/wsdl/soap12/\": // wsdlsoap12\n        case \"http://schemas.xmlsoap.org/soap/encoding/\" : // soapenc\n        case \"http://www.w3.org/2001/XMLSchema\" : // xsd\n          continue;\n      }\n      if (~ns.indexOf('http://schemas.xmlsoap.org/'))\n        continue;\n      if (~ns.indexOf('http://www.w3.org/'))\n        continue;\n      if (~ns.indexOf('http://xml.apache.org/'))\n        continue;\n      str += ' xmlns:' + prefix + '=\"' + ns + '\"';\n    }\n    return str;\n  };\n\n  /*\n   * Have another function to load previous WSDLs as we\n   * don't want this to be invoked externally (expect for tests)\n   * This will attempt to fix circular dependencies with XSD files,\n   * Given\n   * - file.wsdl\n   *   - xs:import namespace=\"A\" schemaLocation: A.xsd\n   * - A.xsd\n   *   - xs:import namespace=\"B\" schemaLocation: B.xsd\n   * - B.xsd\n   *   - xs:import namespace=\"A\" schemaLocation: A.xsd\n   * file.wsdl will start loading, import A, then A will import B, which will then import A\n   * Because A has already started to load previously it will be returned right away and\n   * have an internal circular reference\n   * B would then complete loading, then A, then file.wsdl\n   * By the time file A starts processing its includes its definitions will be already loaded,\n   * this is the only thing that B will depend on when \"opening\" A\n   */\n  static load(uri, options, callback) {\n    var fromCache,\n      WSDL_CACHE;\n\n    if (typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n\n    WSDL_CACHE = options.WSDL_CACHE;\n\n    if (fromCache = WSDL_CACHE[uri]) {\n      /**\n       * Only return from the cache is the document is fully (or partially)\n       * loaded. This allows the contents of a document to have been read\n       * into the cache, but with no processing performed on it yet.\n       */\n      if(fromCache.isLoaded){\n        return callback.call(fromCache, null, fromCache);\n      }\n    }\n\n    return WSDL.open(uri, options, callback);\n  }\n\n  static open(uri, options, callback) {\n    if (typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n\n    // initialize cache when calling open directly\n    var WSDL_CACHE = options.WSDL_CACHE || {};\n    var request_headers = options.wsdl_headers;\n    var request_options = options.wsdl_options;\n\n    debug('wsdl open. request_headers: %j request_options: %j', request_headers, request_options);\n    var wsdl;\n    var fromCache = WSDL_CACHE[uri];\n    /**\n     * If the file is fully loaded in the cache, return it.\n     * Otherwise load it from the file system or URL.\n     */\n    if (fromCache && !fromCache.isLoaded) {\n      fromCache.load(callback);\n    }\n    else if (!/^https?:/.test(uri)) {\n      debug('Reading file: %s', uri);\n      fs.readFile(uri, 'utf8', function(err, definition) {\n        if (err) {\n          callback(err);\n        }\n        else {\n          wsdl = new WSDL(definition, uri, options);\n          WSDL_CACHE[uri] = wsdl;\n          wsdl.WSDL_CACHE = WSDL_CACHE;\n          wsdl.load(callback);\n        }\n      });\n    }\n    else {\n      var httpClient = options.httpClient || new HttpClient(options);\n      httpClient.request(uri, null /* options */,\n        function(err, response, definition) {\n          if (err) {\n            callback(err);\n          } else if (response && response.statusCode === 200) {\n            const wsdlUri = _.get(response, 'request.uri.href', uri);\n            wsdl = new WSDL(definition, wsdlUri, options);\n            WSDL_CACHE[wsdlUri] = wsdl;\n            wsdl.WSDL_CACHE = WSDL_CACHE;\n            wsdl.load(callback);\n          } else {\n            callback(new Error(g.f('Invalid {{WSDL URL}}: %s\\n\\n\\r Code: %s' +\n              \"\\n\\n\\r Response Body: %j\", uri, response.statusCode, response.body)));\n          }\n        }, request_headers, request_options);\n    }\n\n    return wsdl;\n  }\n\n  static loadSync(uri, options) {\n    var fromCache,\n      WSDL_CACHE;\n\n    if (!options) {\n      options = {};\n    }\n\n    WSDL_CACHE = options.WSDL_CACHE;\n\n    if (fromCache = WSDL_CACHE[uri]) {\n      /**\n       * Only return from the cache is the document is fully (or partially)\n       * loaded. This allows the contents of a document to have been read\n       * into the cache, but with no processing performed on it yet.\n       */\n      if(fromCache.isLoaded){\n        return fromCache;\n      }\n    }\n\n    return WSDL.openSync(uri, options);\n  }\n\n  static openSync(uri, options) {\n    if (!options) {\n      options = {};\n    }\n\n    // initialize cache when calling open directly\n    var WSDL_CACHE = options.WSDL_CACHE || {};\n    var request_headers = options.wsdl_headers;\n    var request_options = options.wsdl_options;\n\n    debug('wsdl open. request_headers: %j request_options: %j', request_headers, request_options);\n    var wsdl;\n    var fromCache = WSDL_CACHE[uri];\n    /**\n     * If the file is fully loaded in the cache, return it.\n     * Otherwise throw an error as we cannot load this in a sync way as we would need to perform IO\n     * either to the filesystem or http\n     */\n    if (fromCache && !fromCache.isLoaded) {\n      wsdl = fromCache.loadSync();\n    } else {\n      throw(uri+\" was not found in the cache. For loadSync() calls all schemas must be preloaded into the cache\");\n    }\n\n    return wsdl;\n  }\n\n  static loadSystemSchemas(callback) {\n    var xsdDir = path.join(__dirname, '../../xsds/');\n    var done = false;\n    fs.readdir(xsdDir, function(err, files) {\n      if (err) return callback(err);\n      var schemas = {};\n      var count = files.length;\n      files.forEach(function(f) {\n        WSDL.open(path.join(xsdDir, f), {}, function(err, wsdl) {\n          if (done) return;\n          count--;\n          if (err) {\n            done = true;\n            return callback(err);\n          }\n          for (var s in wsdl.definitions.schemas) {\n            schemas[s] = wsdl.definitions.schemas[s];\n          }\n          if (count === 0) {\n            done = true;\n            callback(null, schemas);\n          }\n        });\n      });\n    });\n  }\n}\n\nWSDL.prototype.ignoredNamespaces = ['targetNamespace', 'typedNamespace'];\nWSDL.prototype.ignoreBaseNameSpaces = false;\nWSDL.prototype.valueKey = '$value';\nWSDL.prototype.xmlKey = '$xml';\n\nmodule.exports = WSDL;\n\nfunction deepMerge(destination, source) {\n  return _.mergeWith(destination || {}, source, function(a, b) {\n    return _.isArray(a) ? a.concat(b) : undefined;\n  });\n}\n"],"file":"wsdl.js"}